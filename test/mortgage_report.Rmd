---
title: "Amortization Report"
output: pdf_document
params:
  loan_amount: 150000
  annual_rate: 0.04
  term: 360
  xtr1: 0
  bonus: 0
header-includes:
- \usepackage{booktabs}
- \usepackage{longtable}
- \usepackage{array}
- \usepackage{multirow}
- \usepackage{wrapfig}
- \usepackage{float}
- \usepackage{colortbl}
- \usepackage{pdflscape}
- \usepackage{tabu}
- \usepackage{threeparttable}
- \usepackage{xcolor}
---

```{r echo=FALSE, message=FALSE, warning=FALSE}

library(tidyverse)
library(knitr)

# Calculate standard amortization schedule
term <- params$term
loan_amount <- params$loan_amount
annual_rate <- params$annual_rate

monthly_rate <- annual_rate/12
total_PI <- loan_amount * 
   (monthly_rate * (1 + monthly_rate) ^ term)/
   (((1 + monthly_rate) ^ term) - 1)

interest <- principal <- balance <- vector("numeric", term)

for (i in 1:term) {
   intr <- loan_amount * monthly_rate
   prnp <- total_PI - intr
   loan_amount <- loan_amount - prnp
   
   interest[i] <- intr
   principal[i] <- prnp
   balance[i] <- loan_amount
}

std_sched <- tibble(Payment = 1:term, 
                    Interest = round(interest, 2), 
                    Principal = round(principal, 2), 
                    Balance = paste("$", format(round(balance, 2), big.mark = ",")))
std_sched %>%
  kable()

loan_amount1 <- params$loan_amount

interest1 <- principal1 <- extra <- balance1 <- bonus <- vector("numeric", term)

for (i in 1:term) {
   intr1 <- loan_amount1 * monthly_rate
   prnp1 <- total_PI - intr1
   xtr1 <- params$xtr1
   loan_amount1 <- loan_amount1 - prnp1 - xtr1 - bonus[i]

   extra[i] <- xtr1
   interest1[i] <- intr1
   principal1[i] <- prnp1
   balance1[i] <- loan_amount1
}

updated_sched_for <- tibble(Payment = 1:term, 
                        Interest = round(interest1, 2), 
                        Principal = paste("$", format(round(principal1, 2), big.mark = ",")), 
                        Extra = paste("$", format(round(extra, 2), big.mark = ",")), 
                        Bonus = paste("$", format(round(bonus, 2), big.mark = ",")),
                        Balance = paste("$", format(round(balance1, 2), big.mark = ","))) %>%
   filter(!grepl("-", Interest))

updated_sched <- tibble(Payment_no = 1:term,
                        Interest = interest1,
                        Principal = principal1,
                        Extra = extra,
                        Bonus = bonus,
                        Balance = balance1)

updated_sched %>%
  gather(2:3, key = "payment", value = "amount") %>%
  ggplot(aes(Payment_no, amount, color = payment)) +
  geom_line() +
  theme_minimal()
```